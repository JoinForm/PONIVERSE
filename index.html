<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>PONIVERSE</title>

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/x-icon" href="image/icon/favicon.ico" />
</head>

<body class="dark-grad" data-auth="out">
  <!-- Hero (로그아웃 표시 전용) -->
  <header class="hero">
    <h1 class="title-animate" id="titleText">PONIVERSE</h1>
    <p class="subtitle">포니버스에 오신 것을 환영합니다</p>

    <!-- 모임 카운트(비로그인도 표시) -->
    <p class="mini-counts" aria-live="polite">
      캠핑 <span id="c1">0</span><span id="d1">/20</span> ·
      보드게임 <span id="c2">0</span><span id="d2">/20</span> ·
      운동 <span id="c3">0</span><span id="d3">/20</span>
    </p>

    <!-- 링크형 버튼 (로그아웃 상태 전용) -->
    <div class="btn-row">
      <a href="signup.html" class="btn">회원가입</a>
      <a href="login.html"  class="btn ghost">로그인</a>
    </div>
  </header>

  <!-- 갤러리 (로그인과 무관, 공개) -->
  <section class="gallery" id="gallery" aria-label="사진 갤러리"></section>

  <!-- 이미지 확대 모달 -->
  <div id="imgModal" class="modal" hidden aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-body">
      <button class="modal-close" data-close="imgModal" aria-label="닫기" type="button">×</button>
      <img id="modalImg" src="" alt="확대 이미지" />
    </div>
  </div>

  <!-- 토스트 -->
  <div class="toast" id="toast" aria-live="polite"></div>

  <!-- 로그아웃 전용 스크립트: 카운트/갤러리만 -->
  <script type="module" src="js/index.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, setPersistence, browserLocalPersistence }
      from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

    const app = initializeApp({
      apiKey:"AIzaSyAfs8ZN-2ANX0lYvT_WVcOMXRkNB5usuRw",
      authDomain:"poniverse-3c351.firebaseapp.com",
      projectId:"poniverse-3c351"
    });
    const auth = getAuth(app);
    await setPersistence(auth, browserLocalPersistence);
    onAuthStateChanged(auth, (user)=>{ if(user) location.href = "home.html"; });
  </script>

  <!-- 로그인 상태 감지 -->
  <script type="module">
    import { auth, onAuthStateChanged, persistenceReady } from "./js/firebase.js";

    // 로그인 유지 설정 완료 후 감시 시작
    await persistenceReady;
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // 로그인되어 있으면 home.html로 자동 이동
        location.href = "home.html";
      }
    });
  </script>


</body>
</html>
