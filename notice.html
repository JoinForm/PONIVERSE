<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>PONIVERSE – 공지사항</title>

  <!-- favicon -->
  <link rel="icon" href="image/icon/favicon.ico" />

  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet" />

  <style>
    :root{
      --card-bg: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.14);
      --card-shadow: 0 10px 30px rgba(0,0,0,0.25);
      --accent: #66d1ff;
      --accent2: #a58cff;
    }

    body.dark-grad { min-height: 100vh; }

    .container { max-width: 1000px; margin: 0 auto; padding: 32px 16px 80px; }

    /* 상단 타이틀 */
    .notice-header { text-align:center; margin: 24px 0 28px; }
    .notice-header h1 {
      font-family: "Jua", sans-serif;
      letter-spacing: .5px;
      font-size: clamp(28px, 3.2vw, 44px);
      margin: 0;
    }
    /* 타이틀 밑줄 포인트 */
    .notice-header .underline {
      width: 110px; height: 4px; border-radius: 999px;
      margin: 10px auto 0;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(102,209,255,.45);
    }

    /* 본문 카드 */
    .notice-card{
      position: relative;
      max-width: 860px;
      margin: 0 auto;
      padding: clamp(18px, 2.4vw, 28px) clamp(16px, 2.2vw, 28px) clamp(24px, 2.8vw, 36px);
      border-radius: 20px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      overflow: hidden;
    }
    /* 그라디언트 테두리 글로우 */
    .notice-card::before{
      content:"";
      position:absolute; inset:-1px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(102,209,255,.45), rgba(165,140,255,.35), rgba(255,255,255,.0));
      pointer-events:none; z-index:0;
      mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      padding: 1px;
    }
    /* 카드 내부 컨텐츠 */
    .md { position:relative; z-index:1; line-height: 1.75; font-size: 16px; color: #eaeaf2; }
    .md h1, .md h2, .md h3 { margin: 1.2em 0 .6em; }
    .md h2 { font-size: 1.25rem; }
    .md h3 { font-size: 1.1rem; }
    .md pre { background: rgba(255,255,255,.08); padding: 12px; border-radius: 10px; overflow:auto; }
    .md code { background: rgba(255,255,255,.08); padding: 0 .25em; border-radius: 4px; }
    .md ul, .md ol { padding-left: 1.2em; margin: .6em 0 .9em; }
    .md li+li { margin-top: .25em; }
    .md a { color: var(--accent); text-decoration: underline; text-underline-offset: 2px; }

    /* 확인 버튼 영역 */
    .notice-ok { text-align:center; margin-top: 28px; }
    .btn { cursor:pointer; }
    .btn.primary{
      padding: 10px 18px; border-radius: 999px; border: none;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:#0c0f14; font-weight:700;
      box-shadow: 0 6px 16px rgba(102,209,255,.35);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .btn.primary:hover{ transform: translateY(-1px); box-shadow: 0 9px 22px rgba(102,209,255,.45); }
    .btn.primary:active{ transform: translateY(0); }
  </style>
</head>
<body class="dark-grad">
  <div class="container">
    <div class="notice-header">
      <h1>공지사항</h1>
      <div class="underline"></div>
    </div>

    <!-- ✨ 카드: 테두리/글라스 효과 -->
    <div class="notice-card">
      <div id="content" class="md">로딩 중...</div>
    </div>
  </div>

  <script type="module">
    // --- Markdown renderer (경량) ---
    function escapeHtml(s){ return s.replace(/[&<>"]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m])); }

    function renderBlocks(md){
      // 코드펜스 분리: text, code, text, code...
      const parts = md.split(/```([\s\S]*?)```/g);
      let html = "";
      for(let i=0;i<parts.length;i++){
        if(i % 2 === 1){ // code block
          html += `<pre><code>${escapeHtml(parts[i])}</code></pre>`;
        }else{
          html += renderInline(parts[i]);
        }
      }
      return html;
    }

    function renderInline(text){
      let t = escapeHtml(String(text || "").replace(/\r\n?/g, "\n"));

      // --- 수평선 ---
      t = t.replace(/^\s*-{3,}\s*$/gm, "<hr>");

      // --- 헤더 ---
      t = t.replace(/^###\s+(.+)$/gm, "<h3>$1</h3>")
          .replace(/^##\s+(.+)$/gm,  "<h2>$1</h2>")
          .replace(/^#\s+(.+)$/gm,   "<h1>$1</h1>");

      // --- 이미지, 링크, 인라인 강조/코드 ---
      t = t.replace(/!\[([^\]]*)\]\(([^)\s]+)(?:\s"[^"]*")?\)/g, '<img src="$2" alt="$1">')
          .replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g, `<a href="$2" target="_blank" rel="noopener">$1</a>`)
          .replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>")
          .replace(/\*(.+?)\*/g, "<em>$1</em>")
          .replace(/`(.+?)`/g, "<code>$1</code>");

      // --- 블록 인용문(> ...) 묶어 처리 ---
      t = t.replace(/(^|\n)(> .*(?:\n> .*)*)/g, (_, lead, block) => {
        const inner = block.replace(/^> ?/gm, "");
        // 인용문 안의 빈 줄은 문단으로, 단일 줄바꿈은 <br>로
        const html = escapeHtml(inner)
          .replace(/  \n/g, "<br>\n")   // 하드 줄바꿈(공백 두 칸)
          .replace(/\\\n/g, "<br>\n")   // 하드 줄바꿈(백슬래시)
          .split(/\n{2,}/).map(p => `<p>${p.replace(/\n/g,"<br>")}</p>`).join("");
        return `${lead}<blockquote>${html}</blockquote>`;
      });

      // --- 목록(ol/ul) ---
      t = t.replace(/(?:^\s*\d+\.\s+.*(?:\n|$))+?/gm, block=>{
        const items = block.trimEnd().split("\n")
          .filter(Boolean)
          .map(line => line.replace(/^\s*\d+\.\s+(.*)$/, "<li>$1</li>"))
          .join("");
        return `<ol>${items}</ol>`;
      });
      t = t.replace(/(?:^\s*[-*]\s+.*(?:\n|$))+?/gm, block=>{
        const items = block.trimEnd().split("\n")
          .filter(Boolean)
          .map(line => line.replace(/^\s*[-*]\s+(.*)$/, "<li>$1</li>"))
          .join("");
        return `<ul>${items}</ul>`;
      });

      // --- 하드 줄바꿈 처리(문단 외부 텍스트용) ---
      t = t.replace(/  \n/g, "<br>\n").replace(/\\\n/g, "<br>\n");

      // --- 문단 처리 ---
      const lines = t.split("\n");
      let out = "", buf = [];
      const flush = ()=>{
        if(buf.length){
          const chunk = buf.join(" ").trim();
          if(chunk) out += `<p>${chunk}</p>`;
          buf = [];
        }
      };
      for(const line of lines){
        if(/^<\/?(h\d|ul|ol|li|pre|code|blockquote|hr|img)/.test(line.trim())){
          flush(); out += line + "\n";
        }else if(line.trim()===""){
          flush();
        }else{
          buf.push(line);
        }
      }
      flush();
      return out;
    }


    async function loadMd(){
      const el = document.getElementById("content");
      try{
        const res = await fetch(`docs/notice.md?ts=${Date.now()}`, { cache:"no-cache" });
        if(!res.ok) throw new Error("파일을 불러올 수 없습니다.");
        const md = await res.text();

        el.innerHTML = renderBlocks(md);

        // h1(예: "포니버스 공지사항") 제거
        el.querySelectorAll("h1").forEach(h => {
          if(h.textContent.includes("포니버스")) h.remove();
        });

        // 하단 중앙 확인 버튼 추가
        const ok = document.createElement("div");
        ok.className = "notice-ok";
        ok.innerHTML = `<button class="btn primary" id="okBtn">확인</button>`;
        el.appendChild(ok);
        document.getElementById("okBtn").addEventListener("click", ()=> location.href = "home.html");
      }catch(e){
        console.error(e);
        el.innerHTML = `
          <p>공지사항을 불러오지 못했습니다. 파일 경로를 확인해 주세요.</p>
          <div class='notice-ok'><button class='btn primary' onclick='location.href="home.html"'>확인</button></div>
        `;
      }
    }

    loadMd();
  </script>
</body>
</html>
